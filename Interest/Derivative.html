<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Calculus Calculator Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#f4f6fb;
  color:#111827;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  padding:18px;
  margin-bottom:16px;
}
h1{margin:0;color:#2563eb}
p.muted{color:#6b7280;margin-top:4px}

.tabs{
  display:flex;
  gap:10px;
  margin:16px 0;
}
.tab{
  flex:1;
  padding:12px;
  text-align:center;
  border-radius:10px;
  background:#eef2ff;
  cursor:pointer;
  font-weight:600;
}
.tab.active{
  background:#2563eb;
  color:#fff;
}

label{font-weight:600;font-size:14px}
input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button.secondary{
  background:#eef2ff;
  color:#111;
  margin-top:10px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.result{
  background:#f9fafb;
  border-radius:10px;
  padding:14px;
}
.step{
  background:#f3f4f6;
  border-radius:8px;
  padding:10px;
  margin-bottom:8px;
}
.badge{
  display:inline-block;
  background:#e0e7ff;
  color:#1e3a8a;
  padding:4px 8px;
  border-radius:999px;
  font-size:12px;
  margin-right:6px;
}
.error{color:#dc2626;font-weight:600}
code{
  background:#111827;
  color:#f9fafb;
  padding:4px 6px;
  border-radius:6px;
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h1>Calculus Calculator Suite</h1>
<p class="muted">Derivatives, Integrals & Limits with steps</p>

<div class="tabs">
  <div class="tab active" onclick="setMode('derivative')">Derivative</div>
  <div class="tab" onclick="setMode('integral')">Integral</div>
  <div class="tab" onclick="setMode('limit')">Limit</div>
</div>

<label>Function f(x)</label>
<input id="fx" value="sin(x^2)">

<div id="derivative">
<label>Order</label>
<select id="order">
  <option value="1">First Derivative</option>
  <option value="2">Second Derivative</option>
</select>

<label>Evaluate at x (optional)</label>
<input id="dx">
</div>

<div id="integral" class="hidden">
<label>Integral Type</label>
<select id="intType">
  <option value="indef">Indefinite</option>
  <option value="def">Definite</option>
</select>

<label>a</label>
<input id="a" value="0">
<label>b</label>
<input id="b" value="2">
</div>

<div id="limit" class="hidden">
<label>Approaches x →</label>
<input id="limx" value="0">
<label>Direction</label>
<select id="limType">
  <option value="both">Both</option>
  <option value="left">Left</option>
  <option value="right">Right</option>
</select>
</div>

<button onclick="calculate()">Calculate</button>
<button class="secondary" onclick="resetAll()">Reset</button>
</div>

<div class="grid">

<div class="card">
<h3>Result</h3>
<div id="rules"></div>
<div class="result" id="result"></div>
</div>

<div class="card">
<h3>Step-by-Step</h3>
<div id="steps"></div>
</div>

</div>
</div>

<script>
let MODE="derivative";

function setMode(m){
  MODE=m;
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelector(`.tab:nth-child(${m==="derivative"?1:m==="integral"?2:3})`).classList.add("active");

  derivative.classList.toggle("hidden",m!=="derivative");
  integral.classList.toggle("hidden",m!=="integral");
  limit.classList.toggle("hidden",m!=="limit");
}

function clean(e){
  return e.replace(/\^/g,"**")
          .replace(/sin/g,"Math.sin")
          .replace(/cos/g,"Math.cos")
          .replace(/tan/g,"Math.tan")
          .replace(/ln/g,"Math.log");
}

function derivative(expr){
  const h=1e-5;
  return x=>(Function("x","return "+expr)(x+h)-Function("x","return "+expr)(x-h))/(2*h);
}

function calculate(){
  result.innerHTML="";
  steps.innerHTML="";
  rules.innerHTML="";

  const expr=clean(fx.value);

  try{
    if(MODE==="derivative"){
      rules.innerHTML='<span class="badge">Numerical Differentiation</span>';
      const d=derivative(expr);
      result.innerHTML=`Derivative computed numerically.`;
      steps.innerHTML+=`<div class="step">Central difference method used</div>`;
      if(dx.value){
        result.innerHTML+=`<br><strong>At x=${dx.value}:</strong> ${d(Number(dx.value)).toFixed(6)}`;
      }
    }

    if(MODE==="integral"){
      rules.innerHTML='<span class="badge">Numerical Integration</span>';
      if(intType.value==="indef"){
        result.innerHTML=`Indefinite integral cannot be expressed symbolically here.`;
        steps.innerHTML+=`<div class="step">Use numerical methods for evaluation</div>`;
      }else{
        let A=Number(a.value),B=Number(b.value);
        let sum=0,n=10000,dx=(B-A)/n;
        for(let i=0;i<n;i++){
          let x=A+i*dx;
          sum+=Function("x","return "+expr)(x)*dx;
        }
        result.innerHTML=`∫ from ${A} to ${B} = ${sum.toFixed(6)}`;
        steps.innerHTML+=`<div class="step">Trapezoidal numerical integration</div>`;
      }
    }

    if(MODE==="limit"){
      rules.innerHTML='<span class="badge">Limit Approximation</span>';
      let L=Number(limx.value),h=1e-6;
      let f=Function("x","return "+expr);
      let val;
      if(limType.value==="left") val=f(L-h);
      else if(limType.value==="right") val=f(L+h);
      else val=(f(L-h)+f(L+h))/2;

      result.innerHTML=`Limit ≈ ${val.toFixed(6)}`;
      steps.innerHTML+=`<div class="step">Approach method using small h</div>`;
    }

  }catch{
    result.innerHTML=`<span class="error">Invalid expression</span>`;
  }
}

function resetAll(){
  fx.value="sin(x^2)";
  dx.value="";
  a.value=0;b.value=2;
  limx.value=0;
  result.innerHTML="";
  steps.innerHTML="";
  rules.innerHTML="";
}
</script>

</body>
</html>
