<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Derivative Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#f4f6fb;
  color:#111827;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  padding:18px;
  margin-bottom:16px;
}
h1{color:#2563eb;margin:0}
p{color:#6b7280}
label{font-weight:600;font-size:14px}
input,select{
  width:100%;
  padding:12px;
  margin:6px 0 14px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
.secondary{
  background:#eef2ff;
  color:#111;
  margin-top:10px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}
.result{
  background:#f9fafb;
  padding:14px;
  border-radius:10px;
}
.step{
  background:#f3f4f6;
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
}
.badge{
  display:inline-block;
  background:#e0e7ff;
  color:#1e3a8a;
  padding:4px 8px;
  border-radius:999px;
  font-size:12px;
  margin-bottom:6px;
}
.error{color:#dc2626;font-weight:600}
code{
  background:#111827;
  color:#f9fafb;
  padding:4px 6px;
  border-radius:6px;
}
</style>
</head>

<body>
<div class="container">

<div class="card">
<h1>Derivative Calculator</h1>
<p>Numerical differentiation with support up to 5th derivative</p>

<label>Function f(x)</label>
<input id="fx" value="sin(x^2)">

<label>Derivative Order</label>
<select id="order">
  <option value="1">First Derivative</option>
  <option value="2">Second Derivative</option>
  <option value="3">Third Derivative</option>
  <option value="4">Fourth Derivative</option>
  <option value="5">Fifth Derivative</option>
</select>

<label>Evaluate at x</label>
<input id="evalx" value="2">

<button onclick="calculate()">Calculate Derivative</button>
<button class="secondary" onclick="resetAll()">Reset</button>
</div>

<div class="grid">
<div class="card">
<h3>Result</h3>
<div id="result" class="result"></div>
</div>

<div class="card">
<h3>Step-by-Step</h3>
<div id="steps"></div>
</div>
</div>

</div>

<script>
function sanitize(expr){
  return expr
    .replace(/\^/g,"**")
    .replace(/sin/g,"Math.sin")
    .replace(/cos/g,"Math.cos")
    .replace(/tan/g,"Math.tan")
    .replace(/ln/g,"Math.log")
    .replace(/e\^/g,"Math.exp");
}

function buildFunction(expr){
  return Function("x","return "+expr);
}

function derivative(fn, order){
  const h=1e-4;

  if(order===0) return fn;

  return x=>{
    if(order===1){
      return (fn(x+h)-fn(x-h))/(2*h);
    }
    return (derivative(fn,order-1)(x+h)
          - derivative(fn,order-1)(x-h))/(2*h);
  };
}

function calculate(){
  const result=document.getElementById("result");
  const steps=document.getElementById("steps");
  result.innerHTML="";
  steps.innerHTML="";

  try{
    const expr=sanitize(fx.value);
    const fn=buildFunction(expr);
    const x=parseFloat(evalx.value);
    const n=parseInt(order.value);

    const dn=derivative(fn,n);
    const value=dn(x);

    result.innerHTML=`
      <span class="badge">${n}${ordinal(n)} Derivative</span><br>
      <strong>Value at x=${x}:</strong> ${value.toFixed(6)}
    `;

    steps.innerHTML+=`
      <div class="step">Used recursive central-difference method</div>
      <div class="step">Each derivative built from the previous order</div>
      <div class="step">Step size h = 0.0001</div>
      <div class="step">Stable up to 5th derivative</div>
    `;
  }
  catch{
    result.innerHTML=`<span class="error">Invalid or unsupported expression</span>`;
  }
}

function ordinal(n){
  return n===1?"st":n===2?"nd":n===3?"rd":"th";
}

function resetAll(){
  fx.value="sin(x^2)";
  evalx.value="2";
  order.value="1";
  result.innerHTML="";
  steps.innerHTML="";
}
</script>

</body>
</html>
