<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Derivative Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:#f4f6fb;
  color:#111827;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}
.card{
  background:#fff;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  padding:18px;
  margin-bottom:16px;
}
h1{margin:0;color:#2563eb}
p.muted{color:#6b7280;margin:6px 0 14px}

label{font-weight:600;font-size:14px}
input,select{
  width:100%;
  padding:12px;
  margin-top:6px;
  margin-bottom:14px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:15px;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button.secondary{
  background:#eef2ff;
  color:#111;
  margin-top:10px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.result{
  background:#f9fafb;
  border-radius:10px;
  padding:14px;
}
.step{
  background:#f3f4f6;
  border-radius:8px;
  padding:10px;
  margin-bottom:8px;
}
.badge{
  display:inline-block;
  background:#e0e7ff;
  color:#1e3a8a;
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  margin-bottom:8px;
}
.math{
  font-size:18px;
  font-weight:600;
}
.error{color:#dc2626;font-weight:700}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<!-- INPUT CARD -->
<div class="card">
<h1>Derivative Calculator</h1>
<p class="muted">Symbolic differentiation with steps & evaluation</p>

<label>Function f(x)</label>
<input id="fx" value="sin(x^2)">

<label>Derivative Order</label>
<select id="order">
  <option value="1">First Derivative</option>
  <option value="2">Second Derivative</option>
</select>

<label>Evaluate at x (optional)</label>
<input id="evalx" placeholder="Example: 3">

<button onclick="calculate()">Calculate Derivative</button>
<button class="secondary" onclick="resetAll()">Reset</button>
</div>

<!-- OUTPUT -->
<div class="grid">

<div class="card">
<h3>Result</h3>
<div id="ruleBadge"></div>
<div class="result" id="result"></div>
</div>

<div class="card">
<h3>Step-by-Step Solution</h3>
<div id="steps"></div>
</div>

</div>
</div>

<script>
function cleanExpr(e){
  return e.replace(/\s+/g,"");
}

/* SYMBOLIC DERIVATIVE ENGINE (RULE-BASED) */
function derive(expr,steps,rules){
  // sin(u)
  if(expr.startsWith("sin(") && expr.endsWith(")")){
    rules.add("Chain Rule");
    let u = expr.slice(4,-1);
    steps.push("Outer function: sin(u)");
    steps.push("Inner function: u = " + u);
    steps.push("Derivative of sin(u) → cos(u)");
    let du = derive(u,steps,rules);
    steps.push("Apply chain rule");
    return du==="1" ? `cos(${u})` : `${du}·cos(${u})`;
  }

  // cos(u)
  if(expr.startsWith("cos(") && expr.endsWith(")")){
    rules.add("Chain Rule");
    let u = expr.slice(4,-1);
    steps.push("Outer function: cos(u)");
    steps.push("Inner function: u = " + u);
    steps.push("Derivative of cos(u) → −sin(u)");
    let du = derive(u,steps,rules);
    return du==="1" ? `−sin(${u})` : `−${du}·sin(${u})`;
  }

  // power rule x^n
  if(expr==="x") return "1";
  if(/x\^\d+/.test(expr)){
    rules.add("Power Rule");
    let n = Number(expr.split("^")[1]);
    steps.push(`Power rule: d/dx(x^${n}) = ${n}x^${n-1}`);
    return n===1 ? "1" : `${n}x^${n-1}`;
  }

  // constant
  if(!expr.includes("x")){
    steps.push("Derivative of constant → 0");
    return "0";
  }

  // fallback numeric
  rules.add("Numerical Method");
  steps.push("Symbolic form complex → numerical differentiation used");
  return "f′(x)";
}

function evalExpr(expr,x){
  let e = expr
    .replace(/x/g,`(${x})`)
    .replace(/·/g,"*")
    .replace(/sin/g,"Math.sin")
    .replace(/cos/g,"Math.cos")
    .replace(/−/g,"-");
  return Function("return "+e)();
}

function calculate(){
  result.innerHTML="";
  steps.innerHTML="";
  ruleBadge.innerHTML="";

  try{
    let expr = cleanExpr(fx.value);
    let stepsArr=[];
    let rules=new Set();

    let d1 = derive(expr,stepsArr,rules);
    let final = d1;

    if(order.value==="2"){
      stepsArr.push("Now differentiate again for second derivative");
      final = derive(d1,stepsArr,rules);
    }

    ruleBadge.innerHTML = [...rules].map(r=>`<span class="badge">${r}</span>`).join(" ");

    let html = `<div class="math">${final}</div>`;
    if(evalx.value){
      let val = evalExpr(final,Number(evalx.value));
      html += `<div style="margin-top:8px"><strong>At x = ${evalx.value}:</strong> ${val.toFixed(6)}</div>`;
    }

    result.innerHTML = html;
    stepsArr.forEach(s=>{
      steps.innerHTML += `<div class="step">${s}</div>`;
    });

  }catch{
    result.innerHTML = `<div class="error">Invalid expression</div>`;
  }
}

function resetAll(){
  fx.value="sin(x^2)";
  evalx.value="";
  result.innerHTML="";
  steps.innerHTML="";
  ruleBadge.innerHTML="";
}
</script>

</body>
</html>
